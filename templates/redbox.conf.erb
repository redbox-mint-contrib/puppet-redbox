<VirtualHost *:80>

       DocumentRoot  <%= @docroot %>
       
       ErrorLog <%= @log_dir %>/error_log

       # Possible values include: debug, info, notice, warn, error, crit,
       # alert, emerg.
       LogLevel warn
       
       ProxyPreserveHost On
       
	<%- if @shibboleth_env -%>
	   ProxyPassMatch /Shibboleth !
	   ProxyPass /default/sso/shibbloeth !
	<%- end -%>
	
	<% @proxy.each do |proxy| %>
		<%- if @has_ssl and @ssl_files -%>
			Redirect permanent <%= proxy['path'] %> https://<%= @server_url %><%= proxy['path'] %>
		<%- else -%>
	       ProxyPass               <%= proxy['path'] %> <%= proxy['url'] %>
	       ProxyPassReverse        <%= proxy['path'] %> <%= proxy['url'] %>
       <%- end -%>
    <%- end -%>

	<% if @shibboleth_env -%>
       <Location /default/sso/shibboleth>
          AuthType shibboleth
          ShibRequireSession On
          require valid-user
       </Location>
    <% end -%>
</VirtualHost>